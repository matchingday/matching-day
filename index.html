<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase 연동 사이트</title>
  <style>
    body { 
      font-family: 'Noto Sans KR', sans-serif; 
      padding: 20px; 
      background-color: #f5f5f5;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    #content { 
      border: 1px solid #ccc; 
      padding: 15px; 
      margin-bottom: 20px;
      background-color: white;
      border-radius: 8px;
      min-height: 100px;
    }
    #adminForm { 
      display: none; 
      margin-bottom: 20px;
    }
    textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    button { 
      padding: 10px 15px; 
      background-color: #0078d4;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #006abc;
    }
    #saveBtn {
      background-color: #28a745;
    }
    #saveBtn:hover {
      background-color: #218838;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
  </style>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="container">
    <h1>Firebase 연동 사이트</h1>
    
    <!-- 콘텐츠 표시 영역 -->
    <div id="content">로딩 중...</div>
    
    <!-- 관리자 전용 인터페이스 -->
    <div id="adminForm">
      <textarea id="adminText" rows="5"></textarea>
      <button id="saveBtn">저장</button>
    </div>
    
    <!-- 관리자 모드 전환 버튼 -->
    <button id="adminToggle">관리자 모드 전환</button>
  </div>

  <script>
    // Firebase 설정 정보
    const firebaseConfig = {
      apiKey: "AIza5yBIQuHRzKQ3HGS-XQ93C9jY1C_EfKmjCcQ",
      authDomain: "matchingday-c0c83.firebaseapp.com",
      projectId: "matchingday-c0c83",
      storageBucket: "matchingday-c0c83.firebasestorage.app",
      messagingSenderId: "713406774583",
      appId: "1:713406774583:web:c553e7827eef5b85bc6eb2",
      measurementId: "G-73MV68XNF9"
    };

    // Firebase 초기화
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // HTML 요소 참조
    const contentDiv = document.getElementById('content');
    const adminForm = document.getElementById('adminForm');
    const adminText = document.getElementById('adminText');
    const saveBtn = document.getElementById('saveBtn');
    const adminToggle = document.getElementById('adminToggle');

    // Firestore 컬렉션 및 문서 참조 (pages 컬렉션의 pageContent 문서)
    const contentDocRef = db.collection('pages').doc('pageContent');

    // 실시간 데이터 읽기
    contentDocRef.onSnapshot(doc => {
      if (doc.exists) {
        const data = doc.data();
        contentDiv.textContent = data.text;
        adminText.value = data.text;
      } else {
        contentDiv.textContent = '콘텐츠가 없습니다. 관리자 모드에서 내용을 추가해주세요.';
        
        // 문서가 존재하지 않으면 초기 데이터 생성 (선택 사항)
        contentDocRef.set({
          text: "여기에 텍스트 내용을 입력하세요."
        }).then(() => {
          console.log("초기 문서가 생성되었습니다.");
        }).catch(error => {
          console.error("문서 생성 오류:", error);
        });
      }
    }, error => {
      console.error("Firestore 데이터 읽기 오류:", error);
      contentDiv.textContent = "데이터를 불러오는 중 오류가 발생했습니다.";
    });

    // 관리자 모드 토글
    let isAdmin = false;
    adminToggle.addEventListener('click', () => {
      isAdmin = !isAdmin;
      adminForm.style.display = isAdmin ? 'block' : 'none';
      adminToggle.textContent = isAdmin ? '관리자 모드 끄기' : '관리자 모드 전환';
    });

    // 저장 버튼 클릭 시 Firestore 업데이트
    saveBtn.addEventListener('click', () => {
      const newText = adminText.value;
      
      // 빈 텍스트 검증
      if (!newText.trim()) {
        alert("내용을 입력해주세요.");
        return;
      }
      
      // Firestore에 데이터 저장
      contentDocRef.set({
        text: newText,
        updatedAt: new Date() // 타임스탬프 추가 (선택사항)
      })
      .then(() => {
        alert('내용이 성공적으로 업데이트되었습니다.');
      })
      .catch(error => {
        console.error("업데이트 오류:", error);
        alert('업데이트 중 오류가 발생했습니다.');
      });
    });
  </script>
</body>
</html>
